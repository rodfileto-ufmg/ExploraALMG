[
  {
    "objectID": "01_Explorando.html",
    "href": "01_Explorando.html",
    "title": "Explorando dados abertos da ALMG",
    "section": "",
    "text": "Seja bem vindo! Neste conjunto de documentos vamos explorar a plataforma de dados abertos da Assembléia Legislativa de Minas Gerais (ALMG).\n\n1 Importação dos dados das proposições legislativas\nVejamos primeiro como exportar os dados. Para este projeto utilizei especificamente o conjunto de arquivos de proposições em formato csv disponibilizados na plataforma da ALMG. Os arquivos foram acessados e carregados em banco de dados no formato sqlite3, o qual pode ser acessado posteriormente em diversas ferramentas para análise, tais como o python e o R.\n\nPythonR\n\n\nimport requests\nimport pandas as pd\nimport sqlite3\nfrom io import StringIO\n\ndef baixar_arquivo_em_memoria(ano):\n    print(f\"Baixando arquivos de proposições para o ano de {ano}\")\n    url = f\"https://dadosabertos.almg.gov.br/arquivo/proposicoes/download?ano={ano}&tipo=CSV\"\n    response = requests.get(url)\n    response.raise_for_status()\n    print(f\"Arquivo de {ano} baixado com sucesso na memória\")\n    return response.text\n\ndef carregar_csv_no_sqlite(ano, conn, tabela_nome='proposicoes'):\n    csv_text = baixar_arquivo_em_memoria(ano)\n    df = pd.read_csv(StringIO(csv_text))\n    # Opcional: adicionar uma coluna com o ano para identificar a origem\n    df['ano_arquivo'] = ano\n    df.to_sql(tabela_nome, conn, if_exists='append', index=False)\n    print(f\"Dados do ano {ano} adicionados na tabela '{tabela_nome}'\")\n\nconn = sqlite3.connect('proposicoes.db')\nanos = range(1980,2026)\nfor ano in anos:\n    carregar_csv_no_sqlite(ano, conn)\nconn.close()\n\n\nlibrary(httr)\nlibrary(readr)\nlibrary(DBI)\nlibrary(RSQLite)\nlibrary(dplyr)\n\nbaixar_arquivo_em_memoria &lt;- function(ano) {\n  message(sprintf(\"Baixando arquivos de proposições para o ano de %d\", ano))\n  url &lt;- sprintf(\"https://dadosabertos.almg.gov.br/arquivo/proposicoes/download?ano=%d&tipo=CSV\", ano)\n  response &lt;- GET(url)\n  \n  if (http_error(response)) {\n    stop(\"Erro ao baixar o arquivo: \", status_code(response))\n  }\n  \n  message(sprintf(\"Arquivo de %d baixado com sucesso na memória\", ano))\n  content(response, \"text\", encoding = \"UTF-8\")\n}\n\ncarregar_csv_no_sqlite &lt;- function(ano, conn, tabela_nome = \"proposicoes\") {\n  csv_text &lt;- baixar_arquivo_em_memoria(ano)\n  \n  df &lt;- read_csv(I(csv_text), show_col_types = FALSE)\n  \n  # Opcional: adicionar coluna com o ano\n  df &lt;- df %&gt;%\n    mutate(ano_arquivo = ano)\n  \n  dbWriteTable(conn, tabela_nome, df, append = TRUE)\n  \n  message(sprintf(\"Dados do ano %d adicionados na tabela '%s'\", ano, tabela_nome))\n}\n\n# Conectar ao banco SQLite\nconn &lt;- dbConnect(RSQLite::SQLite(), \"proposicoes.db\")\n\n# Iterar sobre os anos\nanos &lt;- 1980:2025\nfor (ano in anos) {\n  carregar_csv_no_sqlite(ano, conn)\n}\n\n# Fechar conexão\ndbDisconnect(conn)\n\n\n\n\n\n2 Exploração Inicial dos dados\n\n\nCódigo\nimport pandas as pd\nimport sys\nimport os\nimport sqlite3\nimport locale\n\nlocale.setlocale(locale.LC_ALL, 'pt_BR.UTF-8')\n\n# Adiciona a raiz do projeto ao sys.path\nsys.path.append(os.path.abspath(os.path.join(os.getcwd(), '..')))\n\nfrom funcoes.utils import formatar_numero_brl\n\nfrom funcoes.Figures import create_horizontal_bar_chart_go\n\n# Caminho para o database.db na raiz do projeto\ndb_path = os.path.abspath(os.path.join(os.getcwd(), '../database.db'))\n\n# Conecta ao banco na raiz do projeto\nconn = sqlite3.connect(db_path)\n\ndf = pd.read_sql_query(f\"SELECT * FROM proposicoes\", conn).sort_values('Ano', ascending=False, ignore_index=True)\n\nnr_proposicoes = formatar_numero_brl(len(df), casas_decimais=0)\n\nlegislaturas = pd.read_sql_query(f\"SELECT * from legislaturas\", conn)\n\nlegislaturas['dataInicio'] = pd.to_datetime(legislaturas['dataInicio'], format='%Y-%m-%d')\n\n# Fechar conexão\nconn.close()\n\ninicio_legislaturas_ano = legislaturas['dataInicio'].dt.year\n\n\nDelimitei para esta análise todo o período disponibilizado (1959-2025) resultando na coleta de 193.128 proposicões. A Tabela 1 apresenta uma amostra destes dados. Como informações básicas temos o tipo, número e ano da proposição, o resumo (Ementa), temas (Indexacao) e em que fase do processo legislativo se encontra a proposição.\n\n\n\n\nTabela 1: Amostra dos dados sobre proposições legislativas\n\n\n\n\n\n\n\n\n\n\nCodigo\nTipoProposicao\nSiglaTipoProposicao\nNumero\nAno\nEmenta\nIndexacao\nSituacao\nDataPublicacao\nDataAtualizacao\nDataUltimaAcao\nRegime\nResumo\nOrigem\nLocal\nNomeFaseAtual\nLegislatura\nAutores\nLinkTextos\nano_arquivo\n\n\n\n\n0\nPL 3925/2025\nPROJETO DE LEI\nPL\n3925\n2025\nProíbe o bloqueio remoto de veículos locados p...\n/Tema/Defesa do Consumidor\\n/Tema/Indústria, C...\nAguardando designação de relator em comissão\n13/06/2025\n13/06/2025\n13/06/2025\nDeliberação em dois turnos no Plenário\nProíbe o bloqueio remoto de veículos alugados ...\nNone\nComissão de Constituição e Justiça\nPrimeiro turno nas Comissões\n20\n[{\"id\":15330,\"nome\":\"Deputada Carol Caram\",\"pa...\nhttps://dadosabertos.almg.gov.br/api/proposico...\n2025\n\n\n1\nRQC 12828/2025\nREQUERIMENTO DE COMISSÃO\nRQC\n12828\n2025\nNone\n/Tema/Trabalho, Emprego e Renda/Categoria Prof...\nAguardando publicação do requerimento\nNone\n10/04/2025\n01/04/2025\nVotado nas comissões\nNone\nNone\nComissão de Defesa dos Direitos da Mulher\nNone\n20\n[{\"id\":19150,\"nome\":\"Deputada Ana Paula Siquei...\nhttps://dadosabertos.almg.gov.br/api/proposico...\n2025\n\n\n2\nPL 3534/2025\nPROJETO DE LEI\nPL\n3534\n2025\nReconhece como de relevante interesse cultural...\n/Tema/Municípios e Desenvolvimento Regional/Po...\nAguardando parecer em comissão\n03/04/2025\n29/05/2025\n28/05/2025\nDeliberação em dois turnos no Plenário\nSubstitutivo nº 1: Promove modificações para a...\nNone\nComissão de Cultura\nPrimeiro turno nas Comissões\n20\n[{\"id\":13425,\"nome\":\"Deputado Betinho Pinto Co...\nhttps://dadosabertos.almg.gov.br/api/proposico...\n2025\n\n\n3\nPL 3535/2025\nPROJETO DE LEI\nPL\n3535\n2025\nAutoriza a Secretaria de Estado de Saúde - SES...\n/Tema/Saúde Pública/Procedimentos e Registros ...\nAguardando parecer em comissão\n03/04/2025\n14/04/2025\n11/04/2025\nDeliberação em dois turnos no Plenário\nAutoriza a Secretaria de Estado de Saúde – SES...\nNone\nComissão de Constituição e Justiça\nPrimeiro turno nas Comissões\n20\n[{\"id\":28870,\"nome\":\"Deputado Lucas Lasmar\",\"p...\nhttps://dadosabertos.almg.gov.br/api/proposico...\n2025\n\n\n4\nPL 3536/2025\nPROJETO DE LEI\nPL\n3536\n2025\nAcrescenta artigo à Lei 22256, de 26 de julho ...\n/Tema/Finanças Públicas/Despesas Públicas/Inve...\nAguardando parecer em comissão\n03/04/2025\n29/05/2025\n11/04/2025\nDeliberação em dois turnos no Plenário\nAltera a Lei que institui a política de atendi...\nNone\nComissão de Constituição e Justiça\nPrimeiro turno nas Comissões\n20\n[{\"id\":28869,\"nome\":\"Deputada Lohanna\",\"partid...\nhttps://dadosabertos.almg.gov.br/api/proposico...\n2025\n\n\n\n\n\n\n\n\n\n\nDestaca-se ainda a coluna “Autores” que comporta um dicionário com a lista de parlamentares ou outro tipos entes que participaram da autoria da proposição. A tabela oference ainda link para download do texto completo.\n\nCódigo\nimport numpy as np\n\nfrom funcoes.Figures import create_line_chart_go, create_time_series_chart_go\nfrom funcoes.utils import preprocessar_proposicao_media_movel\n\n# Checar valores nulos\n\n\nvalores_nulos_data = df[df['DataPublicacao'].isnull()]\n\nnr_valores_nulos_data = formatar_numero_brl(len(valores_nulos_data),casas_decimais=0)\n\ndf['data'] = np.where(df['DataPublicacao'].notnull(), df['DataPublicacao'], df['DataAtualizacao'])\n\ndf['data'] = pd.to_datetime(df['data'], format='%d/%m/%Y')\n\ndf['ano'] = df['data'].dt.year\n\ndf['ano'].head()\n\ncontagem_ano = df['ano'].value_counts().reset_index()\n\ncontagem_ano.columns = ['ano', 'contagem']\n\ncontagem_ano.sort_values('ano', ignore_index=True, inplace=True)\n\nfig = create_line_chart_go(\n    data=contagem_ano,\n    x_col='ano',\n    y_col='contagem',\n    title='Contagem Anual de proposições',\n    line_color='green',\n    line_width=3,\n    height=400\n)\n\nfor ano in inicio_legislaturas_ano:\n    if ano &gt;= 1959:\n      fig.add_shape(\n        type=\"line\",\n        x0=ano,\n        y0=0,\n        x1=ano,\n        y1=1,\n        xref='x',\n        yref='paper',\n        line=dict(color=\"red\", width=2, dash=\"dash\")\n    )\n\nproprosicao_media_movel = preprocessar_proposicao_media_movel(df, window=10)\n\n# Step 2: Create chart using the new function\nfig_media_movel = create_time_series_chart_go(\n    data=proprosicao_media_movel,\n    date_col='date',\n    value_col='total_propositions',\n    ma_col='moving_avg_5d',\n    title='Proposições Diárias com Média Móvel de 10 Dias',\n    height=500\n)\n\nfor data in legislaturas['dataInicio']:\n  if data &gt;= pd.Timestamp('1959-01-01'):\n    fig_media_movel.add_shape(\n        type=\"line\",\n        x0=data,\n        y0=0,\n        x1=data,\n        y1=1,\n        xref='x',\n        yref='paper',\n        line=dict(color=\"red\", width=2, dash=\"dash\")\n    )\n\nfig.show()\n\nfig_media_movel.show()\n\n\n\n\n        \n        \n        \n\n\n\n\nEvolução anual\n\n\n\n\n                            \n                                            \n\n\n\n\nSérie temporal com média movel\n\n\n\n\n                            \n                                            \n\n\n\n\nEvolução temporal de proposições\n\n\n\nVamos então observar a evolução de proposições legislativas ao longo do tempo. Primeiramente foi necessário lidar com os dados faltantes, uma vez que há 500 registros sem valores de data de publicação"
  }
]